{{ define "main" }}
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">{{ .Title }}</h1>
      {{ partial "post-meta.html" (dict "page" .) }}

      {{- if .Params.series_title }}
      <nav class="post-series" aria-labelledby="series-heading">
        <h3 id="series-heading" class="visually-hidden">Series: {{ .Params.series_title }}</h3>
        <ol class="post-series-list">
          {{- $currentPage := . -}}
          {{- $seriesPages := where site.RegularPages "Params.series_title" .Params.series_title -}}
          {{- $seriesPages = sort $seriesPages "Params.series_order" -}}
          {{- range $seriesPages }}
            {{- $isCurrent := eq .RelPermalink $currentPage.RelPermalink }}
            <li class="post-series-item{{ if $isCurrent }} post-series-item--current{{ end }}">
              <span class="post-series-number">{{ .Params.series_order }}</span>
              {{- if $isCurrent }}
                <span class="post-series-link" aria-current="location">{{ .Title }}</span>
              {{- else }}
                <a href="{{ .RelPermalink }}" class="post-series-link">{{ .Title }}</a>
              {{- end }}
            </li>
          {{- end }}
        </ol>
      </nav>
      {{- end }}
    </header>

    {{- if .Params.image }}
    {{- $imageResource := resources.Get .Params.image }}
    {{- if $imageResource }}
    {{- $webp := $imageResource.Resize (printf "%dx webp" $imageResource.Width) }}
    {{- $placeholder := $imageResource.Resize "20x webp q20" }}
    {{- $placeholderBase64 := $placeholder.Content | base64Encode }}
    <figure class="post-cover">
      <picture class="post-cover-picture" style="background-image: url('data:image/webp;base64,{{ $placeholderBase64 }}'); background-size: cover; background-position: center;">
        <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
        <img src="{{ $imageResource.RelPermalink }}" alt="{{ .Params.imageAlt | default .Title }}" loading="eager" class="post-cover-img">
      </picture>
    </figure>
    {{- end }}
    {{- end }}

    <div class="post-content">
      {{ .Content }}
    </div>

    <footer class="post-footer">
      <hr>
      {{- if .Params.canonical_url }}
      {{ partial "canonical-url-notice.html" . }}
      {{- end }}

      <div class="post-license">
        <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer" aria-label="Creative Commons Attribution 4.0 License">
          {{ partial "icon" (dict "icon" "creative-commons" "style" "brands") }}
          {{ partial "icon" (dict "icon" "creative-commons-by" "style" "brands") }}
          <span>CC BY 4.0</span>
        </a>
      </div>
    </footer>
  </article>
{{ end }}
