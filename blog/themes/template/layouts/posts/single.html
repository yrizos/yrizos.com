{{ define "main" }}
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">{{ .Title }}</h1>
      {{ partial "post-meta.html" (dict "page" .) }}
    </header>

    {{- if .Params.image }}
    {{- $imageResource := resources.Get .Params.image }}
    {{- if $imageResource }}
    {{- $webp := $imageResource.Resize (printf "%dx webp" $imageResource.Width) }}
    {{- $placeholder := $imageResource.Resize "20x webp q20" }}
    {{- $placeholderBase64 := $placeholder.Content | base64Encode }}
    <figure class="post-cover">
      <picture class="post-cover-picture" style="background-image: url('data:image/webp;base64,{{ $placeholderBase64 }}'); background-size: cover; background-position: center;">
        <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
        <img src="{{ $imageResource.RelPermalink }}" alt="{{ .Params.imageAlt | default .Title }}" loading="eager" class="post-cover-img">
      </picture>
    </figure>
    {{- end }}
    {{- end }}

    <div class="post-content">
      {{ .Content }}
    </div>

    <footer class="post-footer">
      <hr>
      {{- if .Params.canonical_url }}
      {{ partial "canonical-url-notice.html" . }}
      {{- end }}

      <div class="post-license">
        <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">
          <i class="fa-brands fa-creative-commons"></i>
          <i class="fa-brands fa-creative-commons-by"></i>
          <span>CC BY 4.0</span>
        </a>
      </div>
    </footer>
  </article>
{{ end }}
