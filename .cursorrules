# Agent Rules for LLM Assistants

## Initial Context Gathering

**FIRST ACTION: Before any task, read README.md to understand:**

- Project purpose and goals
- Project structure and organization
- Development setup and requirements
- Key dependencies and technologies
- Build and deployment processes

## Core Operating Principles

### 1. Clarification Over Assumption (ABSOLUTE RULE)

**Never proceed with <95% confidence.** If ANY detail is unclear, ask questions FIRST.

**STOP and ASK if:**

- Request has multiple interpretations
- Scope is undefined (what to change, how much to change)
- Technical approach is not specified
- File locations are ambiguous
- Implementation details are missing
- User intent could mean different things

**Question patterns to use:**

```
"Before I implement [X], I need clarification:
- [Specific decision point 1]?
- [Specific decision point 2]?
- [Specific decision point 3]?"
```

**Remember:**

- User PREFERS questions over wrong implementations
- It is IMPOSSIBLE to ask too many clarifying questions
- Making assumptions wastes more time than asking questions
- "Probably what they want" = VIOLATION, must ask
- "This seems obvious" = VIOLATION, must ask
- "This will save time" = VIOLATION, must ask

### 2. Minimal Scope (Do ONLY What's Asked)

**Complete ONLY the explicit request. Do NOT:**

- Add unrequested features
- Refactor unrelated code
- Update unrelated dependencies
- Fill in unspecified details
- Anticipate next steps
- Make anything "complete" beyond the request
- Add "helpful" improvements

**If user asks to:**

- Create a file → Create ONLY that file with specified content
- Add a function → Add ONLY that function as specified
- Fix a bug → Fix ONLY that specific bug

### 3. Questions vs Actions

**If user asks a question → Provide an answer, do NOT implement**

- Information requests do not imply implementation requests
- Answer questions with explanations, not code changes

### 4. Commit Control

**NEVER create commits unless explicitly requested.**

- Making changes ≠ permission to commit
- Only run `git commit` when user directly instructs it
- User controls when changes are committed

## Development Practices

### Code Quality Standards

- Write clean, readable code with clear variable names
- Follow existing code style and patterns
- Add comments only when intent is not obvious
- Write helpful error messages
- Validate inputs and handle edge cases
- Use existing utilities before creating new ones
- Keep functions small and single-purpose
- Avoid premature optimization
- Test changes before considering complete

## Git Workflow

### Pre-Commit Requirements

**REQUIRED BEFORE ANY COMMIT:**

1. **Run verification commands:**

   ```bash
   git status
   git diff
   ```

2. **Read all modified files using file reading tools**

3. **Verify:**
   - Changes match intent
   - No accidental modifications
   - No incomplete changes
   - No unrelated changes

**Filesystem is source of truth, not chat history.**

### Commit Message Format

```
type: subject under 50 chars

- Bullet describing what changed
- Another bullet if multiple changes
- Use dash-space (- ) for bullets
- Describe changes, not file operations
- Keep bullets concise
```

### Commit Type Selection

Choose type matching PRIMARY change:

- `feat:` new feature/functionality
- `fix:` bug fix
- `docs:` documentation only
- `style:` formatting only
- `refactor:` code restructuring
- `perf:` performance improvement
- `test:` tests
- `chore:` maintenance
- `ci:` CI/CD changes
- `build:` build system changes

### Commit Message Rules

**Subject line:**

- Under 50 characters
- Lowercase after colon
- Imperative mood (add, fix, change)
- No period at end

**Body (always required):**

- Describe WHAT changed functionally
- NOT which files changed
- Focus on primary change
- No AI attribution

**FORBIDDEN in messages:**

- "Generated with Claude Code"
- "Co-Authored-By: Claude"
- Any AI attribution

**Body examples:**

- ✅ Good: "Implement JWT token generation"
- ❌ Bad: "Add auth.js file"
- ✅ Good: "Add password validation"
- ❌ Bad: "Update user controller"

### Forbidden Git Commands

**NEVER use `git reset --hard`** - destroys uncommitted changes permanently.

**Use instead:**

- Discard file: `git restore <file>`
- Unstage: `git restore --staged <file>`
- View previous: `git diff` or `git show`

If user requests hard reset, warn about data loss and suggest alternatives.

### Commit Example

```bash
# 1. Verify changes
git status
git diff

# 2. Read modified files
# Read: src/auth.js, src/routes.js, README.md

# 3. Verify intent matches changes

# 4. Commit with proper message
git commit -m "feat: add jwt authentication system

- Implement JWT token generation
- Add login and registration endpoints
- Add token refresh mechanism"
```

## Template Structure Principles (Hugo)

### Layout Organization

- Base layout declares HTML skeleton with semantic landmarks (`<header>`, `<main>`, `<footer>`)
- Wrap page content in shared container utility for consistent width/padding
- Break views into focused Hugo partials
- Document partial inputs
- Pass data explicitly (e.g., with `dict`) not via globals

### Semantic HTML & Accessibility

- Use semantic markup
- Label navigation elements
- Expose machine-readable metadata (`<time datetime>`)
- Provide alt text
- Use safe link attributes for external targets

### Styling System

- Centralize tokens (color, spacing, typography, motion) in dedicated Sass config
- Import component-specific SCSS partials into main bundle
- Keep each SCSS partial scoped to single UI area
- Use section banners to outline intent

### Asset Pipeline

- Feed CSS and JS through Hugo Pipes
- Compile in dev mode
- Minify, fingerprint, and cache for production
- Reuse layout helpers (container widths, spacing variables)
- Avoid ad-hoc measurements

### Content Rendering

- Render collections through shared list partials
- Accept data as parameters
- Sort data beforehand
- Emit both human and machine-friendly metadata

### JavaScript

- Keep interactive behavior in primary JS bundle
- Guard for missing DOM nodes
- Flip classes or icon names for state changes
- Don't rewrite markup dynamically

### Template Hygiene

- Trim extraneous whitespace with `{{-` / `-}}`
- Keep generated HTML clean

## CSS Component Variable System

**APPLIES TO: All component SCSS files (files starting with `_` in `blog/themes/template/assets/css/`)**

### Mandatory Structure

**Every component MUST have:**

1. **Component-level variables at top of file**
2. **Variables reference global semantic variables only**
3. **CSS rules use component variables only**

### Variable Definition Rules

**Component variables MUST:**

- Use semantic naming describing what they represent
- Reference global variables from `_config.scss` as values
- NEVER use hardcoded values

**Example:**

```scss
// ✅ CORRECT
$series-number-bg: lighten($color-text-primary, 45%);
$series-container-top: $space-normal;
$series-number-size: $space-large;

// ❌ INCORRECT
$series-number-bg: #e0e0e0; // Hardcoded
$series-container-top: 1rem; // Hardcoded
```

### CSS Rule Requirements

**CSS rules MUST use component variables ONLY.**

**FORBIDDEN in CSS rules:**

- Direct global variables (`$color-text-primary`, `$space-normal`, `$motion-duration-normal`)
- Hardcoded values (`1rem`, `0.5rem`, `50%`, `0.2em`)
- Calculations with globals (`$space-normal * 2`)

**REQUIRED in CSS rules:**

- Component-level variables exclusively

**Example:**

```scss
// ✅ CORRECT
.post-series {
  margin-top: $series-container-top;
  background: $series-number-bg;
}

// ❌ INCORRECT
.post-series {
  margin-top: $space-normal; // Direct global
  background: #e0e0e0; // Hardcoded
}
```

### Variable Naming Convention

**Pattern: `$component-element-property`**

- **Colors:** `$component-element-state`
  - Examples: `$series-number-bg`, `$series-link-text-hover`
- **Spacing:** `$component-element-gap` or `$component-element-margin`
  - Examples: `$series-container-top`, `$series-items-gap`
- **Sizes:** `$component-element-size`
  - Examples: `$series-number-size`, `$series-number-font-size`
- **Typography:** `$component-element-font-property`
  - Examples: `$series-font-weight`, `$series-font-size`
- **Motion:** `$component-transition-property`
  - Examples: `$series-transition-duration`, `$series-transition-easing`

### Complete Component Template

```scss
// ============================================
// POST SERIES
// ============================================

// Colors
$series-number-bg: lighten($color-text-primary, 45%);
$series-number-bg-active: darken($series-number-bg, 10%);
$series-number-text: $color-background-primary;
$series-link-text: $color-text-primary;
$series-link-text-hover: $color-text-accent;

// Spacing
$series-container-top: $space-normal;
$series-items-gap: $space-tiny;
$series-number-title-gap: $space-normal;

// Sizes
$series-number-size: $space-large;
$series-number-font-size: $font-size-base-mobile;

// Typography
$series-font-weight: $font-weight-normal;

// Motion
$series-transition-duration: $motion-duration-normal;
$series-transition-easing: $motion-easing-normal;

// Component styles using ONLY component variables
.post-series {
  margin-top: $series-container-top;
}

.post-series-number {
  background-color: $series-number-bg;
  color: $series-number-text;
  font-size: $series-number-font-size;
  font-weight: $series-font-weight;
  width: $series-number-size;
  height: $series-number-size;
  transition: background-color $series-transition-duration
    $series-transition-easing;

  &:hover {
    background-color: $series-number-bg-active;
  }
}

.post-series-link {
  color: $series-link-text;

  &:hover {
    color: $series-link-text-hover;
  }
}
```

### Component Review Checklist

When creating or reviewing components:

1. **Variable definitions present?** All component variables at top
2. **Variables reference globals?** No hardcoded values in definitions
3. **CSS uses only component vars?** No globals or hardcoded values in rules
4. **Naming semantic?** Variable names describe purpose clearly
5. **Follows convention?** Matches `$component-element-property` pattern

### Exception: Media Queries

Media query breakpoints may use global layout variables directly as these are structural concerns:

```scss
// ✅ ALLOWED in media queries
@media (max-width: $layout-content-max-width) {
  // Component styles using component variables
}
```

## Summary: Key Decision Points

**Before ANY action, ask yourself:**

1. **Am I 95%+ confident?** If no → Ask questions
2. **Did user explicitly specify this detail?** If no → Ask
3. **Is this the minimum required?** If no → Remove extra scope
4. **Is user asking a question or requesting action?** Answer or act accordingly
5. **Did user ask me to commit?** If no → Don't commit
6. **Have I verified my changes?** If no → Run git status/diff, read files
7. **Am I working on SCSS components?** If yes → Follow component variable rules strictly

**Remember: Asking questions and doing less is ALWAYS better than making assumptions and doing too much.**
