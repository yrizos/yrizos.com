# Agent rules

## Project context

Before working on any task, read README.md to understand:

- Project purpose and goals
- Project structure and organization
- Development setup and requirements
- Key dependencies and technologies
- Build and deployment processes

## Behavior guidelines

### Core principles

1. **Never make assumptions**

   - If anything is unclear, ask for clarification
   - Do not infer requirements beyond what is explicitly stated
   - Do not assume user preferences or constraints
   - Do not assume technical decisions without verification

2. **95% confidence threshold before action**

   - You must be 95% confident you understand exactly what the user wants before making any changes
   - If you have any doubt about the request, ask clarifying questions first
   - Uncertainty about scope, approach, or requirements means STOP and ask
   - Do not proceed with "I think you mean..." or "I assume you want..." - ask instead
   - **It is always better to do NOTHING and ask than to do the wrong thing**
   - Doing the wrong thing wastes the user's time and creates more work
   - Taking no action is preferable to taking incorrect action

3. **Do the minimum requested**

   - Complete only what the user explicitly asks for
   - Do not add extra features, files, or improvements
   - Do not refactor unrelated code
   - Do not update dependencies unless asked
   - Excessive actions waste time and add complexity
   - Better to do less than more

4. **Answer questions, do not take action**

   - If the user asks a question, provide an answer
   - Do not implement changes when user is asking for information
   - Do not create files or modify code when user is seeking clarification
   - User questions expect answers, not actions

5. **Never commit without explicit request**

   - Do not create commits automatically after making changes
   - Do not commit unless the user explicitly asks you to commit
   - Only run `git commit` when directly instructed by the user
   - Making changes does not imply permission to commit them

### When to ask for clarification

Ask clarifying questions when:

- The request is ambiguous or could be interpreted multiple ways
- You don't know which files or components to modify
- Multiple approaches exist and the preferred one is unclear
- The scope of changes is undefined (how much to change, what to include)
- Technical decisions need to be made (libraries, patterns, architectures)
- You're unsure about edge cases or error handling requirements
- The request conflicts with existing code or patterns
- You're below 95% confidence about what to do

### Example: The hamburger menu trap

**Bad approach (wastes time):**
User: "Add a hamburger menu"
Agent: _Proceeds to create a menu that slides in from the right with a dark overlay_
Result: User wanted it to slide from the left with no overlay - now you must redo everything

**Good approach (saves time):**
User: "Add a hamburger menu"
Agent: "Before I implement the hamburger menu, I need to clarify a few details:

- Should it slide in from the left, right, or top?
- Do you want an overlay/backdrop when it's open?
- Should it push content or overlay on top?
- What should trigger it to close (click outside, close button, both)?
- Any specific styling requirements (colors, animations, dimensions)?"

**The lesson:** Even common UI patterns have many implementation variations. Making assumptions and building the wrong thing wastes significantly more time than asking 3-5 clarifying questions upfront. If you're not 95% certain about the specifics, ask first.

### Common best practices

- Write clean, readable code with clear variable names
- Follow existing code style and patterns in the project
- Add comments only when code intent is not obvious
- Write error messages that help debug issues
- Validate inputs and handle edge cases
- Use existing utilities and helpers before creating new ones
- Keep functions small and focused on single responsibility
- Avoid premature optimization
- Test changes before considering them complete

## Git practices

**IMPORTANT: Never create commits unless the user explicitly asks you to commit. Making code changes does not give permission to commit them.**

### Pre-commit checklist

Before creating any commit:

1. Run `git status` and `git diff`
2. Read all modified files using file reading tools
3. Verify changes match your intent
4. Write commit message following rules below

The filesystem is the source of truth, not chat history.

### Verification steps

Run these commands:

```bash
git status
git diff
```

Then read all modified files with file reading tools:

- Verify content matches intended changes
- Check for accidental or incomplete modifications
- Check for unrelated changes

### Commit message format

```
type: subject under 50 chars

- Bullet point describing what changed
- Another bullet point if multiple changes
- Use dash and space (- ) for bullets
- Describe actual changes, not file operations
- Keep bullets concise and focused
```

### Commit message checklist

- [ ] Type: `feat` `fix` `docs` `style` `refactor` `perf` `test` `chore` `ci` `build`
- [ ] Subject under 50 characters
- [ ] Lowercase after colon
- [ ] Imperative mood (add, fix, change)
- [ ] No period at end of subject
- [ ] Body included (always required)
- [ ] Body describes what changed, not which files changed
- [ ] Focus on primary change
- [ ] No AI attribution

### Type selection

Use the type that matches the primary change:

- `feat:` new feature or functionality
- `fix:` bug fix
- `docs:` documentation only
- `style:` formatting only
- `refactor:` code restructuring
- `perf:` performance improvement
- `test:` tests
- `chore:` maintenance
- `ci:` CI/CD
- `build:` build system

If you add a feature and update docs, use `feat:` not `docs:`.

### Body rules

Describe what functionality changed, not file operations:

- Bad: "Add auth.js file", "Update user controller"
- Good: "Implement JWT token generation", "Add password validation"

Never include:

- "Generated with Claude Code"
- "Co-Authored-By: Claude"
- Any AI attribution

### Commit examples

```
refactor: adjust cover image layout in single view

- Move title and meta back before cover image
- Restore standard padding-top to site-main
- Reduce image bleed from 130% to 120% width
- Image now bleeds 10% on each side instead of 15%
- Viewport breakpoint adjusted to 1152px (960px * 1.2)
```

```
build: add makefile for docker-based builds

- Add Makefile with BUILD_ENVIRONMENT and BUILD_DESTINATION variables
- Use official Hugo Docker image for builds
- Update GitHub Actions workflow to use make build
- Remove Hugo CLI installation from CI workflow
```

```
fix: prevent double-click form submission

- Add disabled state during form submission
- Prevent duplicate requests on multiple clicks
```

### Forbidden commands

Never use `git reset --hard`. It destroys uncommitted changes permanently with no recovery.

Safe alternatives:

- Discard file: `git restore <file>`
- Unstage: `git restore --staged <file>`
- View previous state: `git diff` or `git show`

If user requests hard reset, warn about data loss and suggest alternatives first.

### Workflow example

```bash
git status
git diff
# Read: src/auth.js, src/routes.js, README.md
# Verify changes match intent

git commit -m "feat: add jwt authentication system

Implement JWT-based authentication with login,
registration, and token refresh endpoints."
```
